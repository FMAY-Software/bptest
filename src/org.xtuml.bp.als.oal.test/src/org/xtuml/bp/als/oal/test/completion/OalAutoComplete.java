//=====================================================================
//
// NOTE: This file was generated, but is maintained by hand.
// Generated by: UnitTestGenerator.pl
// Version:      1.15
// Matrix:       oal_autocomplete_matrix.txt
//
//=====================================================================

package org.xtuml.bp.als.oal.test.completion;

import org.eclipse.jface.text.BadLocationException;
import org.eclipse.jface.text.BadPositionCategoryException;
import org.eclipse.jface.text.Position;
import org.eclipse.swt.SWT;
import org.eclipse.swt.widgets.Event;
import org.eclipse.ui.IEditorPart;
import org.junit.After;
import org.junit.Before;
import org.xtuml.bp.core.Body_c;
import org.xtuml.bp.core.BridgeBody_c;
import org.xtuml.bp.core.CorePlugin;
import org.xtuml.bp.core.DerivedAttributeBody_c;
import org.xtuml.bp.core.FunctionBody_c;
import org.xtuml.bp.core.Ooaofooa;
import org.xtuml.bp.core.OperationBody_c;
import org.xtuml.bp.core.Package_c;
import org.xtuml.bp.core.ProposalList_c;
import org.xtuml.bp.core.Proposal_c;
import org.xtuml.bp.core.ProvidedOperationBody_c;
import org.xtuml.bp.core.ProvidedSignalBody_c;
import org.xtuml.bp.core.RequiredOperationBody_c;
import org.xtuml.bp.core.RequiredSignalBody_c;
import org.xtuml.bp.core.StateActionBody_c;
import org.xtuml.bp.core.TransitionActionBody_c;
import org.xtuml.bp.core.common.BridgePointPreferencesStore;
import org.xtuml.bp.core.common.ClassQueryInterface_c;
import org.xtuml.bp.core.common.NonRootModelElement;
import org.xtuml.bp.core.ui.Selection;
import org.xtuml.bp.test.common.BaseTest;
import org.xtuml.bp.test.common.UITestingUtilities;
import org.xtuml.bp.ui.canvas.test.CanvasTest;
import org.xtuml.bp.ui.text.activity.ActivityEditor;
import org.xtuml.bp.ui.text.activity.AllActivityModifier;
import org.xtuml.bp.ui.text.activity.ParseAllActivitiesAction;

public class OalAutoComplete extends CanvasTest {
    public static boolean generateResults = false;
    public static boolean useDrawResults = false;
    String[] results = null;

    String test_id = "";

    protected String getResultName() {
        return getClass().getSimpleName() + "_" + test_id;
    }

    protected IEditorPart fActiveEditor;

    protected IEditorPart getActiveEditor() {
        return fActiveEditor;
    }

    public OalAutoComplete(String subTypeClassName, String subTypeArg0) {
        super(null, subTypeArg0);
    }

    protected String getTestId(String src, String dest, String count) {
        return "test_" + count;
    }

    @Before
    public void setUp() throws Exception {
        super.setUp();
        CorePlugin.getDefault().getPluginPreferences().setValue(
  	  	      BridgePointPreferencesStore.ENABLE_PARSE_ON_ACTIVITY_EDITS, true);
		CorePlugin.getDefault().getPluginPreferences()
				.setValue(BridgePointPreferencesStore.CONTENT_ASSIST_ENABLE_AUTO_TRIGGERING, true);
    }
    
    @Override
    protected void initialSetup() throws Exception {
    	loadProject("oal_autocomplete");
    	modelRoot = Ooaofooa.getInstance("/oal_autocomplete/models/oal_autocomplete/Container/Container.xtuml");
    	// create the initial OAL instances
    	Package_c container = Package_c.getOneEP_PKGOnR1401(m_sys, new ClassQueryInterface_c() {
			
			@Override
			public boolean evaluate(Object candidate) {
				return ((Package_c) candidate).getName().equals("Container");
			}
		});
    	Selection.getInstance().clear(); Selection.getInstance().addToSelection(container);
    	ParseAllActivitiesAction action = new ParseAllActivitiesAction();
    	action.run(null);
    };

    @After
    public void tearDown() throws Exception {
        super.tearDown();
    }

    /**
     * "LPAH" is one of the degrees of freedom as specified in this issues
     * test matrix.
     * This routine gets the "LPAH" instance from the given name.
     * 
     * @param element The degree of freedom instance to retrieve
     * @return A model element used in the test as specified by the test matrix
     */
    NonRootModelElement selectLPAH(String element) {
        return selectLPAH(element, null);
    }

    /**
     * "LPAH" is one of the degrees of freedom as specified in this issues
     * test matrix.
     * This routine gets the "LPAH" instance from the given name.
     * 
     * @param element The degree of freedom instance to retrieve
     * @param extraData Extra data needed for selection
     * @return A model element used in the test as specified by the test matrix
     */
    NonRootModelElement selectLPAH(String element, Object extraData) {
        NonRootModelElement nrme = findElementForDof(element);
        if(nrme != null) {
        	// open the editor
        	fActiveEditor = UITestingUtilities.getTextEditorFor(nrme, false);
        } else {
        	assertTrue("An instance with degree of freedom type \"LPAH\" was not found.  Instance Name: " + element + ".", nrme!=null);
        }
        return nrme;
    }

	private int getLineNumber(String element) {
		if(element.contains("S2")) {
			return 2;
		} else if(element.contains("S3")) {
			return 13;
		}
		return 0;
	}

	private String getLocationText() {
		if(getName().contains("L2")) {
			return "l2_var.";
		} else if(getName().contains("L3")) {
			return "::";
		} else if(getName().contains("L4")) {
			return "send";
		} else if(getName().contains("L5")) {
			return "send Port1::";
		} else if(getName().contains("L6")) {
			return "Port1::operation(parameter: 1) to";
		} else if(getName().contains("L7")) {
			return "select one l7_var_one";
		} else if(getName().contains("L8")) {
			return "select one l8_var_one related by l8_var_two->";
		} else if(getName().contains("L9")) {
			return "select one l9_var from instances of ";
		} else if(getName().contains("L10")) {
			return "generate";
		} else if(getName().contains("L11")) {
			return "generate L11Class1:event to";
		} else if(getName().contains("L12")) {
			return "p12_var =";
		} else if(getName().contains("L13")) {
			return "for each l13_var in";
		} else if(getName().contains("L14")) {
			return "return";
		} else if(getName().contains("L15")) {
			return "relate";
		} else if(getName().contains("L16")) {
			return "relate l16_var to";
		} else if(getName().contains("L17")) {
			return "relate l17_var to l17_var_2 across";
		} else if(getName().contains("L18")) {
			return "relate l18_var to l18_var_2 across R1.";
		} else if(getName().contains("L19")) {
			return "relate l19_var to l19_var_other across R2 using";
		} else if(getName().contains("L20")) {
			return "unrelate l20_var from";
		} else if(getName().contains("L21")) {
			return "unrelate l21_var from l21_var_2 across";
		} else if(getName().contains("L22")) {
			return "unrelate l22_var from l22_var_2 across R1.";
		} else if(getName().contains("L23")) {
			return "unrelate l23_var from l23_other across R2 using";
		} else if(getName().contains("L24")) {
			return "self.";
		} else if(getName().contains("L25")) {
			return "";
		} else if(getName().contains("L26")) {
			return "cardinality";
		} else if(getName().contains("L27")) {
			return "param.";
		} else if(getName().contains("L28")) {
			return "create object instance l28_var of";
		} else if(getName().contains("L29")) {
			return "delete object instance";
		} else if(getName().contains("L30")) {
			return "if(";
		} else if(getName().contains("L31")) {
			return "crete event instance l31_var of";
		} else if(getName().contains("L32")) {
			return "create event instance l32_var of L11Class1 to";
		} else if(getName().contains("L33")) {
			return "L33::";
		}
		return "";
	}
	
	private String getPossibility(String element) {
		if(element.contains("P1")) {
			return "control stop";
		} else if (element.contains("P2")) {
			return "create event instance";
		} else if (element.contains("P3")) {
			return "create object instance";
		} else if (element.contains("P4")) {
			return "delete object instance";
		} else if (element.contains("P5")) {
			return "for each";
		} else if (element.contains("P6")) {
			return "generate";
		} else if (element.contains("P7")) {
			return "if";
		} else if (element.contains("P8")) {
			return "param";
		}
		return "";
	}

	private String[] populateAutoComplete(String element) throws BadLocationException, BadPositionCategoryException {
		ActivityEditor editor = getActivityEditor();
		editor.getTextViewer().getDocument().replace(getLineNumber(element), getLocationText().length(), getLocationText());
		BaseTest.dispatchEvents();
		Proposal_c[] proposals = Proposal_c.getManyP_PsOnR1601(ProposalList_c.getManyP_PLsOnR1603(testBody));
		String[] results = new String[proposals.length];
		for(int i = 0; i < results.length; i++) {
			results[i] = proposals[i].getDisplay_text();
		}
		return results;
	}

	private ActivityEditor getActivityEditor() {
		return (ActivityEditor) getActiveEditor();
	}

	Body_c testBody = null;
	private String[] actualProposals;
	NonRootModelElement findElementForDof(String element) {
		if (element.contains("AH1")) {
			testBody = Body_c.getOneACT_ACTOnR698(StateActionBody_c.StateActionBodyInstances(modelRoot));
		} else if (element.contains("AH2")) {
			testBody = Body_c.getOneACT_ACTOnR698(DerivedAttributeBody_c.DerivedAttributeBodyInstance(modelRoot));
		} else if (element.contains("AH3")) {
			testBody = Body_c.getOneACT_ACTOnR698(OperationBody_c.OperationBodyInstance(modelRoot));
		} else if (element.contains("AH4")) {
			testBody = Body_c.getOneACT_ACTOnR698(FunctionBody_c.FunctionBodyInstance(modelRoot));
		} else if (element.contains("AH5")) {
			testBody = Body_c.getOneACT_ACTOnR698(BridgeBody_c.BridgeBodyInstance(modelRoot));
		} else if (element.contains("AH6")) {
			testBody = Body_c.getOneACT_ACTOnR698(ProvidedOperationBody_c.ProvidedOperationBodyInstance(modelRoot));
		} else if (element.contains("AH7")) {
			testBody = Body_c.getOneACT_ACTOnR698(ProvidedSignalBody_c.ProvidedSignalBodyInstance(modelRoot));
		} else if (element.contains("AH8")) {
			testBody = Body_c.getOneACT_ACTOnR698(RequiredOperationBody_c.RequiredOperationBodyInstance(modelRoot));
		} else if (element.contains("AH9")) {
			testBody = Body_c.getOneACT_ACTOnR698(RequiredSignalBody_c.RequiredSignalBodyInstance(modelRoot));
		} else if (element.contains("AH10")) {
			testBody = Body_c.getOneACT_ACTOnR698(BridgeBody_c.BridgeBodyInstance(modelRoot));
		} else if (element.contains("AH11")) {
			testBody = Body_c.getOneACT_ACTOnR698(TransitionActionBody_c.TransitionActionBodyInstance(modelRoot));
		}
		return testBody;
	}
    /**
     * "SV" is one of the degrees of freedom as specified in this issues
     * test matrix.
     * This routine gets the "SV" instance from the given name.
     * 
     * @param element The degree of freedom instance to retrieve
     * @return A model element used in the test as specified by the test matrix
     */
    NonRootModelElement selectSV(String element) {
        return selectSV(element, null);
    }

    /**
     * "SV" is one of the degrees of freedom as specified in this issues
     * test matrix.
     * This routine gets the "SV" instance from the given name.
     * 
     * @param element The degree of freedom instance to retrieve
     * @param extraData Extra data needed for selection
     * @return A model element used in the test as specified by the test matrix
     */
    NonRootModelElement selectSV(String element, Object extraData) {
    	// everything will be selected in the PAH selection, and test run
        return null;
    }

    /**
     * This routine performs the action associated with a matrix cell.
     * The parameters represent model instances aquired based on the specifed
     * column instance and row instance.
     * 
     * @param columnInstance Model instance from the column
     * @param rowInstance Model instance from the row
     * @throws BadPositionCategoryException 
     * @throws BadLocationException 
     */
    void SV_LPAH_Action(NonRootModelElement columnInstance, NonRootModelElement rowInstance) throws BadLocationException, BadPositionCategoryException {
        actualProposals = populateAutoComplete(getName());
    }

    /**
    * This function verifies an expected result.
    *
    * @param source A model element instance aquired through a action taken
    *               on a column of the matrix.
    * @param destination A model element instance aquired through a action taken
    *                    taken on a row of the matrix.
    * @return true if the test succeeds, false if it fails
    */
    boolean checkResult_non(NonRootModelElement source, NonRootModelElement destination) {
        for(String actual : actualProposals) {
        	if(actual.equals(getPossibility(getName()))) {
        		return false;
        	}
        }
        return true;
    }


    /**
    * This function verifies an expected result.
    *
    * @param source A model element instance aquired through a action taken
    *               on a column of the matrix.
    * @param destination A model element instance aquired through a action taken
    *                    taken on a row of the matrix.
    * @return true if the test succeeds, false if it fails
    */
    boolean checkResult_exists(NonRootModelElement source, NonRootModelElement destination) {
        for(String actual : actualProposals) {
        	if(actual.equals(getPossibility(getName()))) {
        		return true;
        	}
        }
        return false;
    }


}
